<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>¿Puedo seguir siendo tu novio?</title>
<style>
  :root{
    --pink:#ff5d8f;
    --green:#2ecc71;
    --red:#ff4b5c;
    --btnW:clamp(90px,20vw,160px);
    --gap:clamp(12px,4vw,28px);
  }
  html,body{
    height:100%;
    margin:0;
    font-family:Inter,Segoe UI,Helvetica,Arial,sans-serif;
    background:#fff;
    color:#111;
  }
  .wrap{
    min-height:100%;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    position:relative;
    overflow:hidden;
    padding:24px;
  }
  h1{
    font-size:clamp(28px,7vw,56px);
    margin:0 0 6px;
    text-align:center;
    font-weight:700;
  }
  p.instr{
    font-size:clamp(12px,2.5vw,16px);
    color:#666;
    margin:0 0 22px;
    text-align:center;
  }
  .drop{
    width:320px;
    max-width:86vw;
    height:120px;
    border-radius:14px;
    border:3px dashed rgba(0,0,0,0.1);
    display:flex;
    align-items:center;
    justify-content:center;
    position:relative;
    background:rgba(255,255,255,0.6);
    box-shadow:0 8px 30px rgba(0,0,0,0.05);
    z-index:2;
  }
  .drop .label{font-weight:600;color:#333;}
  .stage{
    position:relative;
    margin-top:18px;
    width:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }
  .drag-wrap{
    position:relative;
    width:360px;
    max-width:90vw;
    height:160px;
  }
  .btn{
    width:var(--btnW);
    height:var(--btnW);
    border-radius:14px;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:700;
    color:#fff;
    touch-action:none;
    user-select:none;
    cursor:pointer;
    position:absolute;
    top:24px;
    z-index:3;
  }
  .btn.green{
    background:linear-gradient(180deg,var(--green),#1fa65a);
    left:calc(50% - var(--gap)/2 - var(--btnW));
  }
  .btn.red{
    background:linear-gradient(180deg,var(--red),#e03a48);
    left:calc(50% + var(--gap)/2);
  }
</style>
</head>
<body>
<div class="wrap">
  <h1>¿Puedo seguir siendo tu novio?</h1>
  <p class="instr">arrastra la respuesta hacia el recuadro</p>

  <div class="drop" id="drop">
    <div class="label">Respuesta aquí</div>
  </div>

  <div class="stage">
    <div class="drag-wrap" id="stage">
      <div class="btn green" id="yes">Sí</div>
      <div class="btn red" id="no">No</div>
    </div>
  </div>
</div>

<script>
const yes = document.getElementById('yes');
const no = document.getElementById('no');
const drop = document.getElementById('drop');
const stage = document.getElementById('stage');

let active = null;
let start = {x:0,y:0};
let origin = new Map();
let whatsappOpened = false; // evita abrir WhatsApp múltiples veces

function openWhatsApp(){
  if(whatsappOpened) return;
  whatsappOpened = true;
  const phone = '+50557740879';
  const msg = `Si amor podemos seguir siendo novios.\n\nTe amo mucho.\n\nMe comprometo a enviarte foto de mis pies en menos de 5 minutos`;
  const url = `https://wa.me/${phone.replace(/\D/g,'')}?text=${encodeURIComponent(msg)}`;
  window.open(url, '_blank');
}

function setOrigin(el,left,top){ origin.set(el,{x:left,y:top}); }
function getOrigin(el){ return origin.get(el); }

function distToDrop(el){
  const er = el.getBoundingClientRect();
  const dr = drop.getBoundingClientRect();
  const ex = er.left + er.width/2;
  const ey = er.top + er.height/2;
  return Math.hypot(ex - (dr.left + dr.width/2), ey - (dr.top + dr.height/2));
}
function isNearDrop(el,threshold=120){ return distToDrop(el)<threshold; }

function bindPointer(el){
  el.addEventListener('pointerdown', e=>{
    e.preventDefault();
    el.setPointerCapture(e.pointerId);
    active = el;
    start.x = e.clientX;
    start.y = e.clientY;
    const o = getOrigin(el);
    active._startLeft = o.x;
    active._startTop = o.y;
    active._pid = e.pointerId;
    active.style.transition = 'none';
  });
}

window.addEventListener('pointermove', e=>{
  if(!active) return;
  const dx = e.clientX - start.x;
  const dy = e.clientY - start.y;
  active.style.left = (active._startLeft + dx)+'px';
  active.style.top = (active._startTop + dy)+'px';
});

window.addEventListener('pointerup', e=>{
  if(!active) return;
  const el = active;
  active = null;
  if(el._pid) try{ el.releasePointerCapture(el._pid); } catch{}

  if(el.id==='yes' && isNearDrop(el)){
    acceptYes(el);
    openWhatsApp(); // abrir WhatsApp cuando quede en el recuadro
    return;
  }
  if(el.id==='no' && isNearDrop(el)){
    rejectNo(el);
    return;
  }
  revert(el);
});

function revert(el){
  const o = getOrigin(el);
  el.style.transition = 'all .3s';
  el.style.left = o.x+'px';
  el.style.top = o.y+'px';
}

function rejectNo(el){
  el.classList.add('pulse');
  setTimeout(()=>el.classList.remove('pulse'),300);
  revert(el);
}

function acceptYes(el){
  const dr = drop.getBoundingClientRect();
  const sr = stage.getBoundingClientRect();
  const left = (dr.left + dr.width/2) - sr.left - el.offsetWidth/2;
  const top = (dr.top + dr.height/2) - sr.top - el.offsetHeight/2;
  el.style.transition = '.5s';
  el.style.left = left+'px';
  el.style.top = top+'px';
}

// recalcular posiciones originales
function recalcOrigins(){
  const s = stage.getBoundingClientRect();
  [yes,no].forEach(el=>{
    const r = el.getBoundingClientRect();
    const left = r.left - s.left;
    const top = r.top - s.top;
    el.style.left = left+'px';
    el.style.top = top+'px';
    setOrigin(el,left,top);
  });
}

window.addEventListener('resize', recalcOrigins);
window.addEventListener('load', recalcOrigins);
bindPointer(yes);
bindPointer(no);

// opcional: abrir WhatsApp automáticamente si el botón se queda quieto dentro del recuadro
setInterval(()=>{
  if(!active && isNearDrop(yes)){
    openWhatsApp();
  }
}, 200);
</script>
</body>
</html>

